<!-- pages/worker/myInventory/myInventory.wxml -->
<view class="container">
  <!-- 顶部搜索与筛选 -->
  <view class="filter-section">
    <view class="search-bar">
      <icon type="search" size="16" color="#999" />
      <input 
        placeholder="搜索SN码或出库人" 
        bindinput="onSearch" 
        value="{{searchQuery}}"
      />
    </view>
    
    <view class="filter-bar">
      <picker mode="date" value="{{filterDate}}" bindchange="onDateFilterChange">
        <view class="filter-item date-picker {{filterDate ? 'active' : ''}}">
          <image class="filter-icon" src="/images/icons/clock.png"></image>
          <text>{{filterDate || '选择日期'}}</text>
          <icon wx:if="{{filterDate}}" type="clear" size="14" catchtap="clearDateFilter" />
        </view>
      </picker>

      <view class="filter-item sort-btn" bindtap="toggleSort">
        <image class="filter-icon" src="/images/icons/menu.png"></image>
        <text>{{sortOrder === 'desc' ? '最新优先' : '最早优先'}}</text>
      </view>
    </view>
  </view>

  <!-- 记录列表 -->
  <scroll-view scroll-y class="record-list" bindscrolltolower="onReachBottom" refresher-enabled refresher-triggered="{{loading}}" bindrefresherrefresh="onPullDownRefresh">
    <block wx:for="{{filteredRecords}}" wx:key="id">
      <view class="record-card {{item.expanded ? 'expanded' : ''}}">
        <!-- 卡片头部 -->
        <view class="card-header" bindtap="toggleExpand" data-id="{{item.id}}">
          <view class="header-main">
            <view class="sn-row">
              <text class="sn-label">SN:</text>
              <text class="sn-value">{{item.sn}}</text>
            </view>
            <view class="sub-info">
              <view class="sub-item">
                <image class="sub-icon" src="/images/icons/desk.png" mode="aspectFit"></image>
                <text>{{item.customerName || '未知客户'}}</text>
              </view>
              <text class="divider">|</text>
              <view class="sub-item date-item">
                <image class="sub-icon" src="/images/icons/clock.png" mode="aspectFit"></image>
                <text>{{item.activationDate}}</text>
              </view>
            </view>
          </view>
          <view class="arrow-icon {{item.expanded ? 'up' : 'down'}}"></view>
        </view>

        <!-- 详细内容 (展开时显示) -->
        <view class="card-detail" wx:if="{{item.expanded}}">
          <view class="detail-section">
            <view class="detail-item">
              <text class="label">出库人：</text>
              <text class="value">{{item.customerName || '无'}}</text>
            </view>
            <view class="detail-item">
              <text class="label">入库时间：</text>
              <text class="value">{{item.activationDate || '无'}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>

    <!-- 加载中 -->
    <view class="loading-state" wx:if="{{loading && pageNum > 1}}">
      <text>加载中...</text>
    </view>

    <!-- 没有更多了 -->
    <view class="no-more" wx:if="{{!hasMore && records.length > 0}}">
      <text>没有更多记录了</text>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{filteredRecords.length === 0 && !loading}}">
      <image src="/images/icons/note.png" mode="aspectFit" style="width: 120rpx; height: 120rpx; opacity: 0.2; filter: grayscale(1);"></image>
      <text>暂无相关库存记录</text>
    </view>
    
    <view class="bottom-safe"></view>
  </scroll-view>
</view>
