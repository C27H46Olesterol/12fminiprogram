<!--pages/worker/history/history.wxml-->
<view class="history-container">
  <!-- æ—¶é—´ç­›é€‰ -->
  <view class="filter-section">
    <view class="time-filter">
      <picker 
        mode="date" 
        value="{{startDate}}" 
        bindchange="onStartDateChange"
      >
        <view class="date-picker">
          <text class="date-label">å¼€å§‹æ—¥æœŸ</text>
          <text class="date-value">{{startDate}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
      
      <text class="date-separator">è‡³</text>
      
      <picker 
        mode="date" 
        value="{{endDate}}" 
        bindchange="onEndDateChange"
      >
        <view class="date-picker">
          <text class="date-label">ç»“æŸæ—¥æœŸ</text>
          <text class="date-value">{{endDate}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>
    
    <button class="btn btn-primary btn-small" bindtap="onFilter">ç­›é€‰</button>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-section">
    <view class="stats-cards">
      <view class="stats-card">
        <text class="stats-number">{{stats.total}}</text>
        <text class="stats-label">æ€»ä»»åŠ¡æ•°</text>
      </view>
      <view class="stats-card">
        <text class="stats-number">{{stats.completed}}</text>
        <text class="stats-label">å·²å®Œæˆ</text>
      </view>
      <view class="stats-card">
        <text class="stats-number">{{stats.rating}}</text>
        <text class="stats-label">å¹³å‡è¯„åˆ†</text>
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½•åˆ—è¡¨ -->
  <view class="history-list">
    <view 
      class="history-item" 
      wx:for="{{historyList}}" 
      wx:key="id"
      bindtap="onViewHistory"
      data-id="{{item.id}}"
    >
      <view class="history-header">
        <view class="history-title-row">
          <text class="history-title">{{item.title}}</text>
          <view class="status-tag status-completed">å·²å®Œæˆ</view>
        </view>
        <view class="rating-stars">
          <text class="star {{index < item.rating ? 'active' : ''}}" 
                wx:for="{{[1,2,3,4,5]}}" 
                wx:key="index">â˜…</text>
        </view>
      </view>
      
      <text class="history-desc">{{item.description}}</text>
      
      <view class="history-meta">
        <view class="meta-left">
          <text class="history-customer">å®¢æˆ·ï¼š{{item.customerName}}</text>
          <text class="history-phone">ç”µè¯ï¼š{{item.customerPhone}}</text>
        </view>
        <view class="meta-right">
          <text class="history-time">{{item.completeTime}}</text>
        </view>
      </view>
      
      <!-- å¤„ç†è®°å½• -->
      <view class="process-record" wx:if="{{item.processRecord}}">
        <text class="record-label">å¤„ç†è®°å½•ï¼š</text>
        <text class="record-content">{{item.processRecord}}</text>
      </view>
      
      <!-- å®¢æˆ·è¯„ä»· -->
      <view class="customer-review" wx:if="{{item.customerReview}}">
        <text class="review-label">å®¢æˆ·è¯„ä»·ï¼š</text>
        <text class="review-content">{{item.customerReview}}</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!historyList || historyList.length == 0}}">
    <text class="empty-icon">ğŸ“‹</text>
    <text class="empty-text">æš‚æ— å†å²è®°å½•</text>
    <text class="empty-tip">å°è¯•è°ƒæ•´æ—¶é—´èŒƒå›´</text>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && historyList.length > 0}}">
    <button 
      class="btn btn-outline" 
      bindtap="onLoadMore"
      disabled="{{isLoadingMore}}"
    >
      {{isLoadingMore ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}
    </button>
  </view>
</view>