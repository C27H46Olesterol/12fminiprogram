<!--pages/worker/index/index.wxml-->
<view class="worker-home">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <view class="user-info">
      <image class="avatar" src="/images/app-icon.svg" mode="aspectFill"></image>
      <view class="user-details">
        <text class="user-name">{{userInfo.name}}</text>
        <text class="user-role">ç»´ä¿®å·¥</text>
      </view>
      <view class="user-location" bindtap="showRegionPicker">
        <view class="location-icon">ğŸ“</view>
        <text class="location-text">æ³¨å†Œåœ°åŒº{{workerLocation && workerLocation.region ? 'ï¼š' + workerLocation.region : ''}}</text>
      </view>
    </view>
    <view class="user-actions">
      <button class="btn btn-outline btn-small" bindtap="onLogout">é€€å‡º</button>
    </view>
  </view>

  <!-- ä»»åŠ¡æ¦‚è§ˆ -->
  <view class="task-overview">
    <view class="overview-cards">
      <view class="overview-card high-priority">
        <view class="card-icon">ğŸ”´</view>
        <view class="card-content">
          <text class="card-number">{{taskOverview.highPriority}}</text>
          <text class="card-label">é«˜ä¼˜å…ˆçº§</text>
        </view>
      </view>
      
      <view class="overview-card medium-priority">
        <view class="card-icon">ğŸŸ¡</view>
        <view class="card-content">
          <text class="card-number">{{taskOverview.mediumPriority}}</text>
          <text class="card-label">ä¸­ä¼˜å…ˆçº§</text>
        </view>
      </view>
      
      <view class="overview-card completed">
        <view class="card-icon">âœ…</view>
        <view class="card-content">
          <text class="card-number">{{taskOverview.completed}}</text>
          <text class="card-label">å·²å®Œæˆ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <view class="action-item" bindtap="onGoTasks">
      <view class="action-icon tasks-icon">
        <text class="icon">ğŸ“‹</text>
        <view class="task-badge" wx:if="{{pendingTaskCount > 0}}">{{pendingTaskCount}}</view>
      </view>
      <text class="action-title">æˆ‘çš„ä»»åŠ¡</text>
      <text class="action-desc">æŸ¥çœ‹å¾…å¤„ç†ä»»åŠ¡</text>
    </view>
    
    <view class="action-item" bindtap="onGoHistory">
      <view class="action-icon history-icon">
        <text class="icon">ğŸ“Š</text>
      </view>
      <text class="action-title">å†å²è®°å½•</text>
      <text class="action-desc">æŸ¥çœ‹å®Œæˆè®°å½•</text>
    </view>
  </view>

  <!-- ç´§æ€¥ä»»åŠ¡æé†’ -->
  <view class="urgent-tasks" wx:if="{{urgentTasks.length > 0}}">
    <view class="section-title">
      <text class="title-text">ç´§æ€¥ä»»åŠ¡</text>
      <view class="urgent-badge">{{urgentTasks.length}}</view>
    </view>
    
    <view class="urgent-list">
      <view 
        class="urgent-item" 
        wx:for="{{urgentTasks}}" 
        wx:key="id"
        bindtap="onViewUrgentTask"
        data-id="{{item.id}}"
      >
        <view class="urgent-header">
          <text class="urgent-title">{{item.title}}</text>
          <view class="priority-tag priority-high">éå¸¸ç´§æ€¥</view>
        </view>
        <text class="urgent-desc">{{item.description}}</text>
        <view class="urgent-meta">
          <text class="urgent-customer">å®¢æˆ·ï¼š{{item.customerName}}</text>
          <text class="urgent-time">{{item.assignTime}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘ä»»åŠ¡ -->
  <view class="recent-tasks">
    <view class="section-title">
      <text class="title-text">æœ€è¿‘ä»»åŠ¡</text>
      <text class="title-more" bindtap="onViewAllTasks">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    
    <view class="recent-list" wx:if="{{recentTasks.length > 0}}">
      <view 
        class="recent-item" 
        wx:for="{{recentTasks}}" 
        wx:key="id"
        bindtap="onViewRecentTask"
        data-id="{{item.id}}"
      >
        <view class="recent-header">
          <text class="recent-title">{{item.title}}</text>
          <view class="status-tag status-{{item.status}}">
            {{item.statusText}}
          </view>
        </view>
        <view class="recent-meta">
          <text class="recent-customer">å®¢æˆ·ï¼š{{item.customerName}}</text>
          <text class="recent-time">{{item.updateTime}}</text>
        </view>
      </view>
    </view>
    
    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">æš‚æ— æœ€è¿‘ä»»åŠ¡</text>
    </view>
  </view>

  <!-- å·¥ä½œç»Ÿè®¡ -->
  <view class="work-stats">
    <view class="section-title">ä»Šæ—¥å·¥ä½œ</view>
    <view class="stats-cards">
      <view class="stats-card">
        <text class="stats-number">{{todayStats.completed}}</text>
        <text class="stats-label">å·²å®Œæˆ</text>
      </view>
      <view class="stats-card">
        <text class="stats-number">{{todayStats.inProgress}}</text>
        <text class="stats-label">è¿›è¡Œä¸­</text>
      </view>
      <view class="stats-card">
        <text class="stats-number">{{todayStats.rating}}</text>
        <text class="stats-label">å¹³å‡è¯„åˆ†</text>
      </view>
    </view>
  </view>
</view>

<!-- è‡ªå®šä¹‰åœ°åŒºé€‰æ‹©å™¨ -->
<view class="region-picker-modal" wx:if="{{showRegionModal}}" catchtap="hideRegionPicker">
  <view class="region-picker-content" catchtap="stopPropagation">
    <!-- æœç´¢æ¡† -->
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="æœç´¢çœä»½æˆ–åŸå¸‚" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
      />
      <view class="search-icon">ğŸ”</view>
    </view>

    <!-- æœç´¢ç»“æœ -->
    <view class="search-results" wx:if="{{searchKeyword && searchResults.length > 0}}">
      <view 
        class="search-result-item" 
        wx:for="{{searchResults}}" 
        wx:key="index"
        bindtap="selectSearchResult"
        data-province="{{item.province}}"
        data-city="{{item.city}}"
      >
        <text class="result-text">{{item.province}} - {{item.city}}</text>
      </view>
    </view>

    <!-- æ— æœç´¢ç»“æœ -->
    <view class="no-results" wx:if="{{searchKeyword && searchResults.length === 0}}">
      <text>æœªæ‰¾åˆ°åŒ¹é…çš„åœ°åŒº</text>
    </view>

    <!-- çœå¸‚é€‰æ‹©å™¨ -->
    <view class="region-selector" wx:if="{{!searchKeyword}}">
      <view class="selector-columns">
        <!-- çœä»½åˆ— -->
        <scroll-view class="selector-column" scroll-y>
          <view 
            class="selector-item {{selectedProvinceIndex === index ? 'active' : ''}}" 
            wx:for="{{provinceList}}" 
            wx:key="index"
            bindtap="selectProvince"
            data-index="{{index}}"
          >
            {{item}}
          </view>
        </scroll-view>

        <!-- åŸå¸‚åˆ— -->
        <scroll-view class="selector-column" scroll-y>
          <view 
            class="selector-item {{selectedCityIndex === index ? 'active' : ''}}" 
            wx:for="{{cityList}}" 
            wx:key="index"
            bindtap="selectCity"
            data-index="{{index}}"
          >
            {{item}}
          </view>
        </scroll-view>
      </view>
    </view>

    <!-- åº•éƒ¨æŒ‰é’® -->
    <view class="picker-footer">
      <button class="picker-btn cancel-btn" bindtap="hideRegionPicker">å–æ¶ˆ</button>
      <button class="picker-btn confirm-btn" bindtap="confirmRegion">ç¡®å®š</button>
    </view>
  </view>
</view>