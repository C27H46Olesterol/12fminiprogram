<!--pages/client/index/index.wxml-->
<view class="container client-home" bindtap="closeAllDropdowns">
  <!-- æ•…éšœè­¦å‘Š -->
  <view wx:if="{{showFaultAlert && currentFaultInfo}}" class="fault-alert-overlay" catchtap="closeFaultAlert">
    <view class="fault-alert-container" catchtap>
      <!-- å¤´éƒ¨ -->
      <view class="fault-alert-header">
        <view class="fault-icon-container">
          <image class="fault-icon" src="/images/icons/warning.png" mode="aspectFit"></image>
        </view>
        <view class="fault-title-container">
          <text class="fault-code">{{currentFaultInfo.code}}</text>
          <text class="fault-title">{{currentFaultInfo.title}}</text>
        </view>
        <view class="fault-close-btn" bindtap="closeFaultAlert">
          <text class="close-icon">Ã—</text>
        </view>
      </view>

      <!-- è§†é¢‘å±•ç¤ºåŒº (å¦‚æœå­˜åœ¨) -->
      <view class="fault-section" wx:if="{{currentFaultInfo.videoUrl}}">
        <view class="fault-section-title">
          <text class="section-icon">ğŸ¬</text>
          <text>è§†é¢‘æ¼”ç¤º</text>
        </view>
        <video 
          class="fault-video-pop" 
          src="{{currentFaultInfo.videoUrl}}" 
          controls 
          autoplay="{{false}}"
          style="width: 100%; height: 300rpx; border-radius: 12rpx;"
        ></video>
      </view>

      <!-- æ•…éšœåŸå›  -->
      <view class="fault-section">
        <view class="fault-section-title">
          <text class="section-icon">âš ï¸</text>
          <text>å¯èƒ½åŸå› </text>
        </view>
        <text class="fault-cause">{{currentFaultInfo.cause}}</text>
      </view>

      <!-- è§£å†³æ–¹æ¡ˆ -->
      <view class="fault-section">
        <view class="fault-section-title">
          <text class="section-icon">ğŸ”§</text>
          <text>è§£å†³æ–¹æ¡ˆ</text>
        </view>
        <view class="fault-solutions">
          <view wx:for="{{currentFaultInfo.solutions}}" wx:key="index" class="solution-item">
            <text class="solution-number">{{index + 1}}.</text>
            <text class="solution-text">{{item}}</text>
          </view>
        </view>
      </view>

      <!-- åº•éƒ¨æŒ‰é’® -->
      <view class="fault-alert-footer">
        <button class="fault-btn fault-btn-secondary" bindtap="closeFaultAlert">
          æš‚æ—¶å¿½ç•¥
        </button>
        <button class="fault-btn fault-btn-primary" bindtap="goToManual">
          æŸ¥çœ‹ç»´ä¿®æ‰‹å†Œ
        </button>
      </view>
    </view>
  </view>

  <!-- è¿œç¨‹é¥æ§ç•Œé¢ -->
  <view class="section remote-control-section">
    
    <!-- æ–°çš„ç»¼åˆå¤´éƒ¨æ  -->
    <view class="remote-header">
      <!-- 1. å¼€å…³ -->
      <view class="header-btn-item" bindtap="togglePower">
        <view class="power-btn {{deviceStatus.ps === 1 ? 'active' : ''}}">
          <image class="btn-icon-img" src="/images/icons/power.png" mode="aspectFit"></image>
        </view>
        <text class="btn-label">å¼€å…³</text>
      </view>

      <!-- 2. è®¾å¤‡é€‰æ‹© -->
      <view class="device-selector-container" catchtap="toggleDeviceModal">
        <view class="device-selector">
          <view class="device-picker-wrap {{deviceStatus.online ? 'online' : 'offline'}}">
            <image class="selected-device-img-large" src="{{selectedDevice.image || '/images/logo.png'}}" mode="aspectFill"></image>
            <text class="picker-arrow-large {{deviceStatus.online ? 'online' : 'offline'}}" ></text>
          </view>
        </view>
        <text class="device-name-footer">{{selectedDevice.name || 'æœªé€‰æ‹©'}}</text>

        <!-- è®¾å¤‡é€‰æ‹©ä¸‹æ‹‰èœå• -->
        <view class="dropdown-menu device-dropdown {{showDeviceModal ? 'show' : ''}}">
          <block wx:if="{{deviceList.length === 0}}">
            <view class="dropdown-grid">
              <view class="dropdown-item" bindtap="" style="justify-content: center; padding: 20rpx;">
                <text>ç‚¹å‡»å³ä¾§â€œè¿æ¥æ–¹å¼â€è¿æ¥è®¾å¤‡</text>
              </view>
            </view>
          </block>
          <block wx:else>
            <view class="device-list-container">
              <view 
                class="device-list-item {{selectedDeviceIndex === index ? 'selected' : ''}}" 
                wx:for="{{deviceList}}" 
                wx:key="sn" 
                bindtap="onSelectDevice" 
                data-index="{{index}}"
              >
                <!-- 1. è¿æ¥æ–¹å¼æŒ‡ç¤ºå™¨ -->
                <view class="device-connection-indicator">
                  <block wx:if="{{item.connectionType === 'bluetooth'}}">
                    <image class="connection-icon bluetooth-icon" src="/images/icons/bluetooth.png" mode="aspectFit"></image>
                  </block>
                  <block wx:else>
                    <view class="display-signal-bars-small">
                      <view class="display-signal-bar {{item.signalStrength >= 1 ? 'active' : ''}}"></view>
                      <view class="display-signal-bar {{item.signalStrength >= 7 ? 'active' : ''}}"></view>
                      <view class="display-signal-bar {{item.signalStrength >= 13 ? 'active' : ''}}"></view>
                      <view class="display-signal-bar {{item.signalStrength >= 19 ? 'active' : ''}}"></view>
                      <view class="display-signal-bar {{item.signalStrength >= 25 ? 'active' : ''}}"></view>
                    </view>
                  </block>
                </view>

                <!-- 2. å›¾ç‰‡ -->
                <image class="device-list-img" src="{{item.image || '/images/logo.png'}}" mode="aspectFill"></image>

                <!-- 3. ä¿¡æ¯ -->
                <view class="device-list-info">
                  <view class="info-row">
                    <text class="info-label">è®¾å¤‡åç§°ï¼š</text>
                    <text class="info-value">{{item.name}}</text>
                  </view>
                  <view class="info-row">
                    <text class="info-label">è®¾å¤‡å‹å·ï¼š</text>
                    <text class="info-value">{{item.sn}}</text>
                  </view>
                  <view class="info-row">
                    <text class="info-label">æ¿€æ´»æ—¥æœŸï¼š</text>
                    <text class="info-value">{{item.activationDate}}</text>
                  </view>
                  <view class="info-row">
                    <text class="info-label">è¿æ¥æ–¹å¼ï¼š</text>
                    <text class="info-value">{{item.connectionType}}</text>
                  </view>
                </view>
                <!-- 4. å–æ¶ˆé…å¯¹æŒ‰é’® -->
                <view class="device-action-btn-red" catchtap="onUnpairDevice" data-index="{{index}}" data-item="{{item}}" wx:if="{{item.connectionType === 'bluetooth'}}">
                    <text class="delete-icon">Ã—</text>
                  </view>
              </view>
            </view>
          </block>
        </view>
      </view>

      <!-- 3. è¿æ¥æ–¹å¼ -->
      <view class="header-btn-item menu-trigger" catchtap="toggleAddDeviceDropdown">
        <view class="icon-btn">
          <image class="btn-icon-img" src="/images/icons/wirelessconnect.png" mode="aspectFit"></image>
        </view>
        <text class="btn-label">è¿æ¥æ–¹å¼</text>

        <!-- è¿æ¥æ–¹å¼æŠ˜å èœå• (New Style) -->
        <view class="expand-menu connect-menu {{showAddDeviceDropdown ? 'show' : ''}}">
           <view class="expand-item left-text" catchtap="onActivateProduct" style="--i:1">
             <text class="expand-text">4Gè¿æ¥</text>
             <view class="expand-btn-circle">
               <image src="/images/icons/4g.png" mode="aspectFit"></image>
             </view>
           </view>
           <view class="expand-item left-text" catchtap="blueToothfunc" style="--i:2">
             <text class="expand-text">è“ç‰™è¿æ¥</text>
             <view class="expand-btn-circle">
               <image src="/images/icons/bluetooth.png" mode="aspectFit"></image>
             </view>
           </view>
        </view>
      </view>
    </view>

    <!-- ç»¼åˆæ˜¾ç¤ºæ¡† (Consolidated Display) -->
    <view class="display-screen">
      <!-- ç¬¬ä¸€è¡Œï¼šåŸºæœ¬çŠ¶æ€ -->
      <view class="display-row">
        <view class="display-item">
          <text class="display-label">å¼€æœºçŠ¶æ€</text>
          <text class="display-value {{deviceStatus.ps === 1 ? 'active' : ''}}">{{deviceStatus.ps === 1 ? 'ON' : 'OFF'}}</text>
        </view>
        <view class="display-item">
          <text class="display-label">ä¿¡å·</text>
          <view class="display-item-content">
            <block>
              <view class="display-signal-bars-small">
                <view class="display-signal-bar {{deviceStatus.signalStrength >= 1 ? 'active' : ''}}"></view>
                <view class="display-signal-bar {{deviceStatus.signalStrength >= 7 ? 'active' : ''}}"></view>
                <view class="display-signal-bar {{deviceStatus.signalStrength >= 13 ? 'active' : ''}}"></view>
                <view class="display-signal-bar {{deviceStatus.signalStrength >= 19 ? 'active' : ''}}"></view>
                <view class="display-signal-bar {{deviceStatus.signalStrength >= 25 ? 'active' : ''}}"></view>
              </view>
            </block>
          </view>
        </view>
        <view class="display-item">
          <text class="display-label">è®¾å¤‡çŠ¶æ€</text>
          <text class="display-value nomal" wx:if="{{deviceStatus.online}}">åœ¨çº¿</text>
          <text class="display-value" wx:else>ç¦»çº¿</text>
        </view>
      </view>

      <!-- ä¸­é—´ï¼šæ ¸å¿ƒæ˜¾ç¤º (æ¸©åº¦ & æ¨¡å¼) -->
      <view class="display-main">
        <!-- å·¦ä¾§ï¼šæ•…éšœç æ˜¾ç¤º -->
        <view class="display-item fault-status">
          <text class="display-label-mini">æ•…éšœç </text>
          <text class="display-value fault-code {{deviceStatus.err > 0 ? 'error' : 'nomal'}}">{{deviceStatus.err > 0 ? 'E' + deviceStatus.err : '--'}}</text>
        </view>
        <view class="display-item temp-display">
          <text class="temp-value">{{deviceStatus.temp ? deviceStatus.temp / 10 : '--'}}</text>
          <text class="temp-unit">Â°C</text>
        </view>
        <view class="display-item mode-display">
          <text class="mode-text">{{deviceStatus.fm === 2 ? 'åˆ¶å†·' : (deviceStatus.fm === 3 ? 'å¼ºåŠ²' : (deviceStatus.fm === 1 ? 'ç¡çœ ' : (deviceStatus.fm === 4 ? 'åˆ¶çƒ­' : deviceStatus.fm === 0 ? 'é€šé£':'--')))}}</text>
        </view>
      </view>

      <!-- ç¬¬ä¸‰è¡Œï¼šç¯å¢ƒä¿¡æ¯ -->
      <view class="display-row">
        <view class="display-item">
          <text class="display-label">é£é€Ÿ</text>
          <text class="display-value">{{deviceStatus.fs ? deviceStatus.fs + 'æ¡£' : '--'}}</text>
        </view>
        <view class="display-item">
          <text class="display-label">å‡ºé£æ¸©åº¦</text>
          <text class="display-value">{{ deviceStatus.ot ? (deviceStatus.ot === 254 ? 'SHr':(deivceStatus.ot === 255 ? 'OPE' : (deviceStatus.ot -50 + 'Â°C')) ): '--'}}</text>
        </view>
        <view class="display-item">
          <text class="display-label">è¿›é£æ¸©åº¦</text>
          <text class="display-value">{{ deviceStatus.it ? (deviceStatus.it === 254 ? 'SHr':(deivceStatus.it === 255 ? 'OPE' : (deviceStatus.it -50 + 'Â°C')) ): '--'}}</text>
        </view>
      </view>

      <!-- ç¬¬å››è¡Œï¼šæ›´å¤šçŠ¶æ€ -->
      <view class="display-row">
        <view class="display-item">
          <text class="display-label">ä¸Šä¸‹æ‘†é£</text>
          <text class="display-value {{deviceStatus.sxbf === 1 ? 'active' : ''}}">{{deviceStatus.sxbf === 1 ? 'ON' : 'OFF'}}</text>
        </view>
        <view class="display-item">
          <text class="display-label">å·¦å³æ‘†é£</text>
          <text class="display-value {{deviceStatus.zybf === 1 ? 'active' : ''}}">{{deviceStatus.zybf === 1 ? 'ON' : 'OFF'}}</text>
        </view>
        <view class="display-item">
          <text class="display-label">ç”µå‹</text>
          <text class="display-value">{{deviceStatus.bv ? deviceStatus.bv / 10 : '--'}}V</text>
        </view>
      </view>

      <!-- ç¬¬äº”è¡Œï¼šæ‰©å±•åŠŸèƒ½çŠ¶æ€ -->
      <view class="display-row">
        <view class="display-item">
          <text class="display-label">ç…§æ˜ç¯</text>
          <text class="display-value {{deviceStatus.light === 1 ? 'active' : ''}}">{{deviceStatus.light === 1 ? 'ON' : 'OFF'}}</text>
        </view>
        <view class="display-item">
          <text class="display-label">æ°›å›´ç¯</text>
          <text class="display-value {{deviceStatus.fl >= 1 ? 'active' : ''}}">{{deviceStatus.fl >= 1 ? 'ON' : 'OFF'}}</text>
        </view>
        <view class="display-item">
          <text class="display-label">è´Ÿç¦»å­</text>
          <text class="display-value {{deviceStatus.fu === 1 ? 'active' : ''}}">{{deviceStatus.fu === 1 ? 'ON' : 'OFF'}}</text>
        </view>
      </view>
    </view>

    <!-- ä¸­é—´æ§åˆ¶åŒºåŸŸ (Split Layout) -->
    <view class="control-panel-split">
      <!-- å·¦ä¾§ï¼šé£é€Ÿæ§åˆ¶ -->
      <view class="control-column">
        <view class="control-pill">
          <view class="control-btn" 
                bindtouchstart="onControlStart" 
                bindtouchend="onControlEnd" 
                bindtouchcancel="onControlEnd" 
                data-action="increaseWindSpeed">
            <image class="control-icon-img" src="/images/icons/plus.png" mode="aspectFit"></image>
          </view>
          <view class="control-icon-area">
            <view class="control-title">é£é€Ÿ</view>
          </view>
          <view class="control-btn" 
                bindtouchstart="onControlStart" 
                bindtouchend="onControlEnd" 
                bindtouchcancel="onControlEnd" 
                data-action="decreaseWindSpeed">
            <image class="control-icon-img" src="/images/icons/minus.png" mode="aspectFit"></image>
          </view>
        </view>
      </view>

      <!-- å³ä¾§ï¼šæ¸©åº¦æ§åˆ¶ -->
      <view class="control-column">
        <view class="control-pill">
          <view class="control-btn" 
                bindtouchstart="onControlStart" 
                bindtouchend="onControlEnd" 
                bindtouchcancel="onControlEnd" 
                data-action="increaseTemperature">
            <image class="control-icon-img" src="/images/icons/plus.png" mode="aspectFit"></image>
          </view>
          <view class="control-icon-area">
            <view class="control-title">æ¸©åº¦</view>
          </view>
          <view class="control-btn" 
                bindtouchstart="onControlStart" 
                bindtouchend="onControlEnd" 
                bindtouchcancel="onControlEnd" 
                data-action="decreaseTemperature">
            <image class="control-icon-img" src="/images/icons/minus.png" mode="aspectFit"></image>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠŸèƒ½æŒ‰é’®åŒºåŸŸ (Updated Single Row with Pull-out Buttons) -->
    <view class="function-area">
      <view class="func-grid-row">
        
        <!-- 1. æ¨¡å¼é”® (Auto/Strong/Eco/Fan) -->
        <view class="func-btn-wrapper" catchtap="toggleModeDropdown" catchlongpress="">
          <view class="func-btn circle {{deviceStatus.ps === 1 ? 'active' : ''}}">
            <image class="func-icon-img" src="/images/icons/{{deviceStatus.fm === 2 ? 'cold':(deviceStatus.fm === 3 ? 'strong' : (deviceStatus.fm === 1 ? 'moon' : (deviceStatus.fm === 0 ? 'wind' : 'mods')))}}.png" mode="aspectFit"></image>
            <!-- <view class="ellipsis-marker">...</view> -->
          </view>
          <text class="func-label">{{deviceStatus.fm === 2 ? 'åˆ¶å†·' : (deviceStatus.fm === 3 ? 'å¼ºåŠ²' : (deviceStatus.fm === 1 ? 'ç¡çœ ' : (deviceStatus.fm === 0 ? 'é€šé£' : 'æ¨¡å¼')))}}</text>
          
          <!-- Mode Expandable -->
          <view class="expand-menu {{showModeDropdown ? 'show' : ''}}">
             <view class="expand-item" catchtap="selectMode" data-mode="2" style="--i:1">
               <view class="expand-btn-circle {{deviceStatus.fm === 2 ? 'active' : ''}}">
                 <image src="/images/icons/cold.png" mode="aspectFit"></image>
               </view>
               <text class="expand-text">åˆ¶å†·</text>
             </view>
             <view class="expand-item" catchtap="selectMode" data-mode="3" style="--i:2">
               <view class="expand-btn-circle {{deviceStatus.fm === 3 ? 'active' : ''}}">
                 <image src="/images/icons/strong.png" mode="aspectFit"></image>
               </view>
               <text class="expand-text">å¼ºåŠ²</text>
             </view>
             <view class="expand-item" catchtap="selectMode" data-mode="1" style="--i:3">
               <view class="expand-btn-circle {{deviceStatus.fm === 1 ? 'active' : ''}}">
                 <image src="/images/icons/moon.png" mode="aspectFit"></image>
               </view>
               <text class="expand-text">ç¡çœ </text>
             </view>
             <view class="expand-item" catchtap="selectMode" data-mode="0" style="--i:4">
               <view class="expand-btn-circle {{deviceStatus.fm === 0 ? 'active' : ''}}">
                 <image src="/images/icons/wind.png" mode="aspectFit"></image>
               </view>
               <text class="expand-text">é€šé£</text>
             </view>
          </view>
        </view>

        <!-- 2. æ‘†é£é”® (Up/Down, Left/Right) -->
        <view class="func-btn-wrapper" catchtap="toggleSwingDropdown" catchlongpress="">
          <view class="func-btn circle {{deviceStatus.ps === 1 && (deviceStatus.sxbf === 1 || deviceStatus.zybf === 1) ? 'active' : ''}}">
            <image class="func-icon-img" src="{{(deviceStatus.sxbf === 1 && deviceStatus.zybf === 1) ? '/images/icons/wind5.png' : (deviceStatus.zybf === 1 ? '/images/icons/sidetoside.png' : '/images/icons/uptodown.png')}}" mode="aspectFit"></image>
            <!-- <view class="ellipsis-marker">...</view> -->
          </view>
          <text class="func-label">{{(deviceStatus.sxbf === 1 && deviceStatus.zybf === 1) ? 'å…¨å‘æ‘†é£' : (deviceStatus.zybf === 1 ? 'å·¦å³æ‘†é£' : (deviceStatus.sxbf === 1 ? 'ä¸Šä¸‹æ‘†é£' : 'æ‘†é£'))}}</text>

          <!-- Swing Expandable -->
          <view class="expand-menu {{showSwingDropdown ? 'show' : ''}}">
             <!-- <view class="expand-item" catchtap="selectSwing" data-type="off" style="--i:1">
                <view class="expand-btn-circle {{deviceStatus.sxbf === 0 && deviceStatus.zybf === 0 ? '' : ''}}">
                  <image src="/images/icons/baned.png" mode="aspectFit" style="opacity: 0.5;"></image>
                </view>
                <text class="expand-text">å…³é—­</text>
             </view> -->
             <view class="expand-item" catchtap="selectSwing" data-type="ud" style="--i:2">
                <view class="expand-btn-circle {{deviceStatus.sxbf === 1 ? 'active' : ''}}">
                  <image src="/images/icons/uptodown.png" mode="aspectFit"></image>
                </view>
                <text class="expand-text">ä¸Šä¸‹</text>
             </view>
             <view class="expand-item" catchtap="selectSwing" data-type="lr" style="--i:3">
                <view class="expand-btn-circle {{deviceStatus.zybf === 1 ? 'active' : ''}}">
                  <image src="/images/icons/sidetoside.png" mode="aspectFit"></image>
                </view>
                <text class="expand-text">å·¦å³</text>
             </view>
             <!-- <view class="expand-item" catchtap="selectSwing" data-type="both" style="--i:4">
                <view class="expand-btn-circle {{deviceStatus.sxbf === 1 && deviceStatus.zybf === 1 ? 'active' : ''}}">
                  <image src="/images/icons/wind5.png" mode="aspectFit"></image>
                </view>
                <text class="expand-text">å…¨å‘</text>
             </view> -->
          </view>
        </view>

        <!-- 3. åŠŸèƒ½é”® (Lighting/Surround/Anion) -->
        <view class="func-btn-wrapper" catchtap="toggleFunctionDropdown" catchlongpress="">
          <view class="func-btn circle {{deviceStatus.ps === 1 && (deviceStatus.light === 1 || deviceStatus.fl === 1 || deviceStatus.fu === 1) ? 'active' : ''}}">
            <image class="func-icon-img" src="/images/icons/manu.png" mode="aspectFit"></image>
            <!-- <view class="ellipsis-marker">...</view> -->
          </view>
          <text class="func-label">åŠŸèƒ½</text>

          <!-- Function Expandable -->
          <view class="expand-menu {{showFunctionDropdown ? 'show' : ''}}">
             <view class="expand-item" catchtap="selectFunction" data-func="off" style="--i:1">
               <view class="expand-btn-circle">
                 <image src="/images/icons/light_off.png" mode="aspectFit"></image>
               </view>
               <text class="expand-text">å…¨éƒ¨å…³é—­</text>
             </view>
             <view class="expand-item" catchtap="selectFunction" data-func="light" style="--i:2">
               <view class="expand-btn-circle {{deviceStatus.light === 1 ? 'active' : ''}}">
                 <image src="/images/icons/light_on.png" mode="aspectFit"></image>
               </view>
               <text class="expand-text">ç…§æ˜ç¯</text>
             </view>
             <view class="expand-item" catchtap="selectFunction" data-func="surround" style="--i:3">
               <view class="expand-btn-circle {{deviceStatus.fl === 0 ? '' : 'active'}}">
                 <image src="/images/icons/light_on.png" mode="aspectFit"></image>
               </view>
               <text class="expand-text">æ°›å›´ç¯</text>1
             </view>
             <view class="expand-item" catchtap="selectFunction" data-func="clean" style="--i:4">
               <view class="expand-btn-circle {{deviceStatus.fu === 1 ? 'active' : ''}}">
                 <image src="/images/icons/fu.png" mode="aspectFit"></image>
               </view>
               <text class="expand-text">è´Ÿç¦»å­</text>
             </view>
          </view>
        </view>

        <!-- 4. å®šæ—¶ (Existing) -->
        <view class="func-btn-wrapper" bindtap="timerTest">
          <view class="func-btn circle {{deviceStatus.ps === 1 && deviceStatus.timer ? 'active' : ''}}" >
            <image class="func-icon-img" src="/images/icons/clock.png" mode="aspectFit"></image>
          </view>
          <text class="func-label">{{(deviceStatus.ps === 1 && deviceStatus.timer) ? deviceStatus.timerDisplay : 'å®šæ—¶'}}</text>
        </view>
      </view>
    </view>

  <!-- å®šæ—¶å¼¹çª— -->
  <view wx:if="{{showTimerModal}}" class="timer-modal-overlay">
    <view class="timer-modal">
      <text class="timer-title">è®¾ç½®å®šæ—¶</text>

      <view class="timer-selected">{{formattedTimer}}</view>

      <view class="timer-controls">
        <view class="timer-btn-wrap" bindtap="changeTimer" data-delta="-30">
          <view class="timer-arrow">-</view>
          <text class="timer-tip">å‡å°‘30åˆ†é’Ÿ</text>
        </view>
        
        <view class="timer-btn-wrap" bindtap="changeTimer" data-delta="30">
          <view class="timer-arrow">+</view>
          <text class="timer-tip">å¢åŠ 30åˆ†é’Ÿ</text>
        </view>
      </view>

      <view class="timer-actions">
        <button class="action-btn cancel" bindtap="closeTimerModal">å–æ¶ˆ</button>
        <button class="action-btn confirm" bindtap="confirmTimer">ç¡®å®š</button>
      </view>
    </view>
  </view>

  </view>

  <!-- è“ç‰™æœç´¢å¼¹çª— -->
  <view wx:if="{{showBluetoothModal}}" class="bluetooth-modal-overlay">
    <view class="bluetooth-modal">
      <view class="modal-header">
        <text class="modal-title">å‘ç°è“ç‰™è®¾å¤‡</text>
        <view class="close-btn" bindtap="closeBluetoothModal">Ã—</view>
      </view>

      <view class="search-status">
        <block wx:if="{{isSearchingBluetooth}}">
          <view class="searching-spinner"></view>
          <text>æ­£åœ¨æœç´¢ä¸­... {{bluetoothSearchTimer}}s</text>
        </block>
        <block wx:else>
          <text>æœç´¢ç»“æŸ</text>
        </block>
      </view>

      <scroll-view scroll-y class="bluetooth-list">
        <block wx:if="{{bluetoothDevices.length > 0}}">
          <view 
            class="bluetooth-item" 
            wx:for="{{bluetoothDevices}}" 
            wx:key="deviceId" 
            bindtap="connectToBluetooth" 
            data-id="{{item.deviceId}}"
          >
            <image class="bt-icon" src="/images/icons/bluetooth.png" mode="aspectFit"></image>
            <view class="bt-info">
              <text class="bt-name">{{item.name || item.localName || 'æœªçŸ¥è®¾å¤‡'}}</text>
              <text class="bt-id">{{item.deviceId}}</text>
              <text class="bt-id">{{item.advertisServiceUUIDs}}</text>
            </view>
            <!-- <text class="bt-rssi">ä¿¡å·: {{item.RSSI}}</text> -->
          </view>
        </block>
        <view wx:elif="{{!isSearchingBluetooth}}" class="no-bt-devices">
          <text>é™„è¿‘æœªå‘ç°å¯ç”¨è“ç‰™è®¾å¤‡</text>
        </view>
      </scroll-view>

      <view class="modal-footer">
        <button class="bt-action-btn refresh" bindtap="manualRefreshBluetooth">é‡æ–°æœç´¢</button>
        <button class="bt-action-btn close" bindtap="closeBluetoothModal">å…³é—­</button>
      </view>
    </view>
  </view>
</view>

