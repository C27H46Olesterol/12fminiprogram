<!--pages/client/index/index.wxml-->
<view class="container client-home">
  <!-- 用户信息选项卡 -->
  <view class="user-info-card mb-20">
    <!-- 未登录状态 -->
    <view class="user-info-unlogin" wx:if="{{!hasUserInfo}}">
      <view class="unlogin-text">
        <text class="greeting">您好，请登录</text>
        <text class="sub-text">登录后享受更多服务</text>
      </view>
      <button class="login-btn" bindtap="onGoLogin">登录</button>
    </view>

    <!-- 已登录状态 -->
    <view class="user-info-logged" wx:else>
      <view class="user-avatar-box">
        <image class="user-avatar" src="{{userInfo.avatarUrl || 'cloud://cloud1-5ga6xyav93b12d47.636c-cloud1-5ga6xyav93b12d47-1386774416/icon/avatar.svg'}}" binderror="onAvatarError"></image>
      </view>
      <view class="user-details">
        <view class="user-top-row">
          <text class="user-name">{{userInfo.nickName || '微信用户'}}</text>
          <text class="user-phone" wx:if="{{userInfo.phone || userInfo.phoneNumber}}">{{userInfo.phone || userInfo.phoneNumber}}</text>
        </view>
        <view class="user-address" wx:if="{{userLocation.address}}">
          <text class="icon-location"></text>
          <text>{{userLocation.address}}</text>
        </view>
        <view class="user-address" wx:else>
          <text class="icon-location"></text>
          <text></text>
        </view>
      </view>
      <!-- 菜单按钮 -->
      <view class="menu-btn" bindtap="toggleDropdown">
        <text class="menu-icon">⋮</text>
      </view>
      <!-- 下拉菜单 -->
      <view class="dropdown-menu {{showDropdown ? 'show' : ''}}">
        <view class="dropdown-item" bindtap="onApiTest">
          <text>接口测试</text>
        </view>
        <view class="dropdown-item" bindtap="onLogout">
          <text>退出登陆</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 功能栏 -->
  <view class="header-bar flex flex-between flex-v-center mb-20">
    <text class="page-title">服务中心</text>
  </view>

  <!-- 我的设备区域 -->
  <view class="section-header mb-20">
    <text class="section-title">我的设备</text>
    <view class="section-add-btn" bindtap="onActivateProduct">
      <text class="section-plus-icon">+</text>
    </view>
  </view>
  
  <!-- 有设备时显示列表 -->
  <scroll-view scroll-x="true" class="my-product-scroll" enable-flex="true" wx:if="{{myProducts && myProducts.length > 0}}">
    <view class="my-product-list">
      <view class="my-product-item card" wx:for="{{myProducts}}" wx:key="id" bindtap="onProductDetail" data-id="{{item.id}}" data-product-code="{{item.name}}" data-image="{{item.image}}">
        <image class="my-product-img" src="{{item.image || 'cloud://cloud1-5ga6xyav93b12d47.636c-cloud1-5ga6xyav93b12d47-1386774416/default_img/device.png'}}" mode="aspectFit" bindtap="" data-product-code="{{item.name}}" data-image="{{item.image}}"></image>
        <view class="my-product-info">
          <text class="my-product-name" bindtap="" data-product-code="{{item.name}}">{{item.name}}</text>
          <text class="my-product-status {{item.status === 'active' ? 'status-success' : 'status-error'}}" bindtap="onProductStatusTap" data-product-code="{{item.name}}" data-status="{{item.status}}">
            {{item.status === 'active' ? '质保中' : '已过保'}}
          </text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 无设备时显示虚线占位 -->
  <view class="empty-device-box" bindtap="onActivateProduct" wx:else>
    <view class="plus-large">+</view>
    <text class="empty-text">点击激活您的第一台设备</text>
  </view>

  <!-- 服务进度区域 -->
  <!-- <view class="section-header mt-20 mb-20">
    <text class="section-title">服务进度</text>
    <view class="section-add-btn" bindtap="onAddService">
      <text class="section-plus-icon">+</text>
    </view>
  </view>
   -->
  <!-- 有进度时显示 -->
  <!-- <view class="progress-list" wx:if="{{recentFeedbacks && recentFeedbacks.length > 0}}">
    <view class="card progress-card" wx:for="{{recentFeedbacks}}" wx:key="id" bindtap="onViewFeedback" data-id="{{item.id}}">
      <image class="progress-icon" src="cloud://cloud1-5ga6xyav93b12d47.636c-cloud1-5ga6xyav93b12d47-1386774416/icon/issues.svg" mode="aspectFit"></image>
      <view class="progress-content">
        <view class="flex flex-between mb-20">
          <text class="progress-title">{{item.title}}</text>
          <text class="status-text text-primary">{{item.statusText}}</text>
        </view>
        <text class="progress-desc text-secondary">{{item.description}}</text>
      </view>
    </view>
  </view> -->

  <!-- 无进度时显示空状态 -->
  <!-- <view class="empty-progress-card card flex flex-center" wx:else>
    <text class="text-secondary">暂无正在进行的服务</text>
  </view> -->

</view>
