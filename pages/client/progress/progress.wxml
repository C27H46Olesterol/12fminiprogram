<!--pages/client/progress/progress.wxml-->
<view class="progress-container">
  <!-- æœç´¢æ¡† -->
  <view class="search-section">
    <view class="search-box">
      <input 
        class="search-input" 
        type="text" 
        placeholder="æœç´¢ç¼–å·æˆ–å…³é”®è¯" 
        value="{{searchKeyword}}" 
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <button class="btn btn-primary btn-small" bindtap="onSearch">æœç´¢</button>
    </view>
  </view>

  <!-- ç­›é€‰æ¡ä»¶ -->
  <view class="filter-section">
    <view class="filter-tabs">
      <view 
        class="filter-tab {{statusFilter === 'all' ? 'active' : ''}}"
        bindtap="onStatusFilter"
        data-status="all"
      >
        å…¨éƒ¨
      </view>
      <view 
        class="filter-tab {{statusFilter === 'rating' ? 'active' : ''}}"
        bindtap="onStatusFilter"
        data-status="rating"
      >
        å¾…è¯„ä»·
      </view>
      <view 
        class="filter-tab {{statusFilter === 'pending' ? 'active' : ''}}"
        bindtap="onStatusFilter"
        data-status="pending"
      >
        å¾…å¤„ç†
      </view>
      <view 
        class="filter-tab {{statusFilter === 'assigned' ? 'active' : ''}}"
        bindtap="onStatusFilter"
        data-status="assigned"
      >
        å·²åˆ†é…
      </view>
      <view 
        class="filter-tab {{statusFilter === 'resolved' ? 'active' : ''}}"
        bindtap="onStatusFilter"
        data-status="resolved"
      >
        å·²è§£å†³
      </view>
      <view 
        class="filter-tab {{statusFilter === 'cancelled' ? 'active' : ''}}"
        bindtap="onStatusFilter"
        data-status="cancelled"
      >
        å·²å–æ¶ˆ
      </view>
    </view>
  </view>

  <!-- åé¦ˆåˆ—è¡¨ -->
  <view class="feedback-list">
    <view 
      class="card feedback-item" 
      wx:for="{{filteredFeedbacks}}" 
      wx:key="id"
      style="border-left: 6rpx solid var(--primary-color);"
    >
      <view bindtap="onViewFeedback" data-id="{{item.id}}">
        <view class="feedback-header">
          <view class="feedback-title-row">
            <text class="card-title" style="flex: 1;">{{item.title}}</text>
          </view>
          <view class="status-tag status-{{item.status}}">
            {{item.statusText}}
          </view>
        </view>
        
        <text class="feedback-desc">{{item.description}}</text>
        
        <view class="feedback-meta">
          <view class="meta-left">
            <text class="feedback-id">#{{item.id}}</text>
            <text class="feedback-time">{{item.createTime}}</text>
          </view>
          <view class="meta-right">
            <text class="feedback-type">{{item.problemType}}</text>
          </view>
        </view>
        
        <!-- å¤„ç†è¿›åº¦ -->
        <view class="progress-info" wx:if="{{item.status !== 'pending'}}">
          <view class="progress-item">
            <text class="progress-label">å¤„ç†äººï¼š</text>
            <text class="progress-value">{{item.assignee || 'æœªåˆ†é…'}}</text>
          </view>
          <view class="progress-item" wx:if="{{item.lastUpdateTime}}">
            <text class="progress-label">æ›´æ–°æ—¶é—´ï¼š</text>
            <text class="progress-value">{{item.lastUpdateTime}}</text>
          </view>
        </view>
      </view>
      
      <!-- è¯„ä»·æŒ‰é’®ï¼ˆä»…å·²è§£å†³çš„é—®é¢˜æ˜¾ç¤ºï¼‰ -->
      <view class="action-buttons" wx:if="{{item.status === 'resolved' && !item.hasRated}}">
        <button 
          class="btn btn-secondary btn-small" 
          catchtap="onRateIssue" 
          data-id="{{item.id}}"
        >
          â­ è¯„ä»·æœåŠ¡
        </button>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{filteredFeedbacks.length === 0}}">
    <text class="empty-icon">ğŸ”</text>
    <text class="empty-text">æš‚æ— ç›¸å…³åé¦ˆ</text>
    <text class="empty-tip">å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰æ¡ä»¶</text>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && filteredFeedbacks.length > 0}}">
    <button 
      class="btn btn-outline" 
      bindtap="onLoadMore"
      disabled="{{isLoadingMore}}"
    >
      {{isLoadingMore ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}
    </button>
  </view>
</view>