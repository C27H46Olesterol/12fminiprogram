<!--pages/manager/worker-detail/worker-detail.wxml-->
<view class="worker-detail-page">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-icon">â³</text>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç»´ä¿®å·¥ä¿¡æ¯ -->
  <view class="worker-info-section" wx:if="{{workerInfo && !loading}}">
    <!-- å¤´éƒ¨å¡ç‰‡ -->
    <view class="worker-header-card">
      <view class="worker-avatar-large">
        <text class="avatar-icon">ğŸ‘·</text>
      </view>
      <view class="worker-basic-info">
        <text class="worker-name-large">{{workerInfo.name}}</text>
        <text class="worker-phone-large">ğŸ“± {{workerInfo.phone}}</text>
        <view class="worker-location-large">
          <text class="location-icon">ğŸ“</text>
          <text>{{workerInfo.province}} - {{workerInfo.city}}</text>
        </view>
      </view>
      <button class="btn-call" bindtap="onCallPhone">
        <text>ğŸ“</text>
      </button>
    </view>

    <!-- é—¨åº—ä¿¡æ¯ -->
    <view class="worker-store-card" wx:if="{{workerInfo.storeName || workerInfo.region}}">
      <view class="card-title">é—¨åº—ä¿¡æ¯</view>
      <view class="store-info-item" wx:if="{{workerInfo.storeName}}">
        <text class="store-label">é—¨åº—åç§°ï¼š</text>
        <text class="store-value">{{workerInfo.storeName}}</text>
      </view>
      <view class="store-info-item" wx:if="{{workerInfo.region}}">
        <text class="store-label">æ‰€åœ¨åœ°åŒºï¼š</text>
        <text class="store-value">{{workerInfo.region}}</text>
      </view>
    </view>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <view class="worker-stats-card">
      <view class="card-title">å·¥ä½œç»Ÿè®¡</view>
      <view class="stats-grid">
        <view class="stat-box" bindtap="onTabChange" data-tab="completed">
          <text class="stat-number-large">{{workerInfo.completedCount || 0}}</text>
          <text class="stat-label-large">å·²å®Œæˆ</text>
          <text class="stat-hint">ç‚¹å‡»æŸ¥çœ‹ â†’</text>
        </view>
        <view class="stat-box" bindtap="onTabChange" data-tab="processing">
          <text class="stat-number-large">{{workerInfo.processingCount || 0}}</text>
          <text class="stat-label-large">å¤„ç†ä¸­</text>
          <text class="stat-hint">ç‚¹å‡»æŸ¥çœ‹ â†’</text>
        </view>
        <view class="stat-box" bindtap="onTabChange" data-tab="ratings">
          <text class="stat-number-large">{{workerInfo.averageRating || '-'}}</text>
          <text class="stat-label-large">å¹³å‡è¯„åˆ†</text>
          <text class="stat-hint">ç‚¹å‡»æŸ¥çœ‹ â†’</text>
        </view>
        <view class="stat-box">
          <text class="stat-number-large">{{workerInfo.registerDays || 0}}</text>
          <text class="stat-label-large">æ³¨å†Œå¤©æ•°</text>
          <text class="stat-hint">{{workerInfo.registerTimeText}}</text>
        </view>
      </view>
    </view>

    <!-- Tab åˆ‡æ¢ -->
    <view class="tab-bar">
      <view 
        class="tab-item {{activeTab === 'info' ? 'active' : ''}}"
        bindtap="onTabChange"
        data-tab="info"
      >
        <text>åŸºæœ¬ä¿¡æ¯</text>
      </view>
      <view 
        class="tab-item {{activeTab === 'completed' ? 'active' : ''}}"
        bindtap="onTabChange"
        data-tab="completed"
      >
        <text>å·²å®Œæˆ ({{workerInfo.completedCount || 0}})</text>
      </view>
      <view 
        class="tab-item {{activeTab === 'processing' ? 'active' : ''}}"
        bindtap="onTabChange"
        data-tab="processing"
      >
        <text>å¤„ç†ä¸­ ({{workerInfo.processingCount || 0}})</text>
      </view>
      <view 
        class="tab-item {{activeTab === 'ratings' ? 'active' : ''}}"
        bindtap="onTabChange"
        data-tab="ratings"
      >
        <text>è¯„åˆ†è¯¦æƒ…</text>
      </view>
    </view>

    <!-- å†…å®¹åŒºåŸŸ -->
    <view class="tab-content">
      <!-- åŸºæœ¬ä¿¡æ¯ Tab -->
      <view class="info-tab" wx:if="{{activeTab === 'info'}}">
        <view class="info-card">
          <view class="card-title">æ³¨å†Œä¿¡æ¯</view>
          <view class="info-item">
            <text class="info-label">æ³¨å†Œæ—¶é—´ï¼š</text>
            <text class="info-value">{{workerInfo.registerTimeText}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">æ³¨å†Œå¤©æ•°ï¼š</text>
            <text class="info-value">{{workerInfo.registerDays}} å¤©</text>
          </view>
          <view class="info-item">
            <text class="info-label">è”ç³»ç”µè¯ï¼š</text>
            <text class="info-value">{{workerInfo.phone}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">æ‰€åœ¨åœ°åŒºï¼š</text>
            <text class="info-value">{{workerInfo.province}} - {{workerInfo.city}}</text>
          </view>
        </view>

        <view class="info-card" wx:if="{{workerInfo.storeName || workerInfo.region}}">
          <view class="card-title">é—¨åº—ä¿¡æ¯</view>
          <view class="info-item" wx:if="{{workerInfo.storeName}}">
            <text class="info-label">é—¨åº—åç§°ï¼š</text>
            <text class="info-value">{{workerInfo.storeName}}</text>
          </view>
          <view class="info-item" wx:if="{{workerInfo.region}}">
            <text class="info-label">æ‰€åœ¨åœ°åŒºï¼š</text>
            <text class="info-value">{{workerInfo.region}}</text>
          </view>
        </view>

        <view class="info-card">
          <view class="card-title">å·¥ä½œç»Ÿè®¡</view>
          <view class="info-item">
            <text class="info-label">å·²å®Œæˆå·¥å•ï¼š</text>
            <text class="info-value">{{workerInfo.completedCount || 0}} ä¸ª</text>
          </view>
          <view class="info-item">
            <text class="info-label">å¤„ç†ä¸­å·¥å•ï¼š</text>
            <text class="info-value">{{workerInfo.processingCount || 0}} ä¸ª</text>
          </view>
          <view class="info-item">
            <text class="info-label">å¹³å‡è¯„åˆ†ï¼š</text>
            <text class="info-value">{{workerInfo.averageRating || '-'}}</text>
          </view>
        </view>
      </view>

      <!-- å·²å®Œæˆå·¥å• Tab -->
      <view class="issues-tab" wx:if="{{activeTab === 'completed'}}">
        <view 
          class="issue-card" 
          wx:for="{{completedIssues}}" 
          wx:key="_id"
          bindtap="onViewIssue"
          data-id="{{item._id}}"
        >
          <view class="issue-header">
            <text class="issue-id">{{item.issueId}}</text>
            <view class="issue-status resolved">
              <text>âœ… {{item.statusText}}</text>
            </view>
          </view>
          <view class="issue-content">
            <text class="issue-description">{{item.description}}</text>
          </view>
          <view class="issue-info-row">
            <text class="issue-info-item">ğŸ“… {{item.createTimeText}}</text>
          </view>
          <view class="issue-info-row" wx:if="{{item.resolvedTime}}">
            <text class="issue-info-item">âœ… {{item.resolvedTimeText}}</text>
          </view>
          <view class="issue-info-row" wx:if="{{item.projectType}}">
            <text class="issue-info-item">ğŸ”§ {{item.projectType}}</text>
          </view>
          <view class="issue-footer">
            <text class="view-detail">æŸ¥çœ‹è¯¦æƒ… â†’</text>
          </view>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{completedIssues.length === 0 && !completedLoading}}">
          <text class="empty-icon">ğŸ“‹</text>
          <text class="empty-text">æš‚æ— å·²å®Œæˆå·¥å•</text>
        </view>

        <!-- åŠ è½½æ›´å¤š -->
        <view class="load-more" wx:if="{{completedHasMore && !completedLoading && completedIssues.length > 0}}">
          <button class="btn-load-more" bindtap="onLoadMoreIssues">åŠ è½½æ›´å¤š</button>
        </view>

        <!-- åŠ è½½çŠ¶æ€ -->
        <view class="loading-more" wx:if="{{completedLoading}}">
          <text>åŠ è½½ä¸­...</text>
        </view>

        <!-- æ²¡æœ‰æ›´å¤š -->
        <view class="no-more" wx:if="{{!completedHasMore && completedIssues.length > 0}}">
          <text>æ²¡æœ‰æ›´å¤šäº†</text>
        </view>
      </view>

      <!-- å¤„ç†ä¸­å·¥å• Tab -->
      <view class="issues-tab" wx:if="{{activeTab === 'processing'}}">
        <view 
          class="issue-card" 
          wx:for="{{processingIssues}}" 
          wx:key="_id"
          bindtap="onViewIssue"
          data-id="{{item._id}}"
        >
          <view class="issue-header">
            <text class="issue-id">{{item.issueId}}</text>
            <view class="issue-status processing">
              <text>â³ {{item.statusText}}</text>
            </view>
          </view>
          <view class="issue-content">
            <text class="issue-description">{{item.description}}</text>
          </view>
          <view class="issue-info-row">
            <text class="issue-info-item">ğŸ“… {{item.createTimeText}}</text>
          </view>
          <view class="issue-footer">
            <text class="view-detail">æŸ¥çœ‹è¯¦æƒ… â†’</text>
          </view>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{processingIssues.length === 0 && !processingLoading}}">
          <text class="empty-icon">ğŸ“‹</text>
          <text class="empty-text">æš‚æ— å¤„ç†ä¸­å·¥å•</text>
        </view>

        <!-- åŠ è½½æ›´å¤š -->
        <view class="load-more" wx:if="{{processingHasMore && !processingLoading && processingIssues.length > 0}}">
          <button class="btn-load-more" bindtap="onLoadMoreIssues">åŠ è½½æ›´å¤š</button>
        </view>

        <!-- åŠ è½½çŠ¶æ€ -->
        <view class="loading-more" wx:if="{{processingLoading}}">
          <text>åŠ è½½ä¸­...</text>
        </view>

        <!-- æ²¡æœ‰æ›´å¤š -->
        <view class="no-more" wx:if="{{!processingHasMore && processingIssues.length > 0}}">
          <text>æ²¡æœ‰æ›´å¤šäº†</text>
        </view>
      </view>

      <!-- è¯„åˆ†è¯¦æƒ… Tab -->
      <view class="ratings-tab" wx:if="{{activeTab === 'ratings'}}">
        <view class="rating-card" wx:for="{{ratings}}" wx:key="_id">
          <view class="rating-header">
            <view class="rating-stars">
              <text class="star {{index < item.rating ? 'active' : ''}}" wx:for="{{[1,2,3,4,5]}}" wx:for-item="star" wx:for-index="index" wx:key="star">â­</text>
            </view>
            <text class="rating-score">{{item.rating}}.0 åˆ†</text>
          </view>
          
          <view class="rating-issue-info">
            <text class="rating-issue-id">å·¥å•ï¼š{{item.issueId}}</text>
            <text class="rating-time">{{item.createTimeText}}</text>
          </view>

          <view class="rating-content" wx:if="{{item.comment}}">
            <text class="rating-comment">{{item.comment}}</text>
          </view>

          <view class="rating-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <text class="rating-tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="tag">{{tag}}</text>
          </view>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{ratings.length === 0 && !ratingsLoading}}">
          <text class="empty-icon">â­</text>
          <text class="empty-text">æš‚æ— è¯„åˆ†è®°å½•</text>
        </view>

        <!-- åŠ è½½æ›´å¤š -->
        <view class="load-more" wx:if="{{ratingsHasMore && !ratingsLoading && ratings.length > 0}}">
          <button class="btn-load-more" bindtap="onLoadMoreRatings">åŠ è½½æ›´å¤š</button>
        </view>

        <!-- åŠ è½½çŠ¶æ€ -->
        <view class="loading-more" wx:if="{{ratingsLoading}}">
          <text>åŠ è½½ä¸­...</text>
        </view>

        <!-- æ²¡æœ‰æ›´å¤š -->
        <view class="no-more" wx:if="{{!ratingsHasMore && ratings.length > 0}}">
          <text>æ²¡æœ‰æ›´å¤šäº†</text>
        </view>
      </view>
    </view>
  </view>
</view>

