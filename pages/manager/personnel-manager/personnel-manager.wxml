<!--pages/manager/personnel-manager/personnel-manager.wxml-->
<view class="worker-list-page">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">ç»´ä¿®å·¥åˆ—è¡¨</text>
    <text class="page-subtitle">æŸ¥çœ‹æ‰€æœ‰ç»´ä¿®å·¥ä¿¡æ¯</text>
  </view>

  <!-- ç­›é€‰åŒºåŸŸ -->
  <view class="filter-section">
    <!-- åœ°åŒºé€‰æ‹©å™¨ - è‡ªå®šä¹‰å¼¹çª— -->
    <view class="region-selector">
      <view class="picker-display-full" bindtap="showRegionModal">
        <text class="picker-label-full">åœ°åŒºé€‰æ‹©ï¼š</text>
        <view class="picker-value-full">
          <text class="region-text">{{displayRegion}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </view>
    </view>

    <!-- æœç´¢æ¡† -->
    <view class="search-box">
      <text class="search-icon-left">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢å§“åã€ç”µè¯æˆ–åœ°åŒº"
        placeholder-class="search-placeholder"
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
        bindconfirm="onSearch"
      />
      <text 
        class="search-clear {{searchKeyword ? 'show' : ''}}" 
        bindtap="onClearSearch"
      >âœ•</text>
    </view>

    <!-- é‡ç½®æŒ‰é’® -->
    <view class="filter-actions">
      <button class="btn-reset" bindtap="onResetFilter">é‡ç½®ç­›é€‰</button>
      <text class="result-count">å…± {{totalCount}} åç»´ä¿®å·¥</text>
    </view>
  </view>

  <!-- ç»´ä¿®å·¥åˆ—è¡¨ -->
  <view class="worker-list">
    <view 
      class="worker-card" 
      wx:for="{{workers}}" 
      wx:key="_id"
      bindtap="onViewWorkerDetail"
      data-id="{{item._id}}"
    >
      <!-- ç»´ä¿®å·¥åŸºæœ¬ä¿¡æ¯ -->
      <view class="worker-header">
        <view class="worker-avatar">
          <text class="avatar-icon">ğŸ‘·</text>
        </view>
        <view class="worker-info">
          <view class="worker-name-row">
            <text class="worker-name">{{item.name}}</text>
            <view class="worker-badge" wx:if="{{item.isOnline}}">
              <text class="badge-dot">â—</text>
              <text class="badge-text">åœ¨çº¿</text>
            </view>
          </view>
          <text class="worker-phone">ğŸ“± {{item.phone}}</text>
        </view>
      </view>

      <!-- åœ°åŒºä¿¡æ¯ -->
      <view class="worker-location">
        <view class="location-item">
          <text class="location-icon">ğŸ“</text>
          <text class="location-text">{{item.province}} - {{item.city}}</text>
        </view>
      </view>

      <!-- é—¨åº—ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰ -->
      <view class="worker-store" wx:if="{{item.storeName}}">
        <view class="store-item">
          <text class="store-label">é—¨åº—ï¼š</text>
          <text class="store-value">{{item.storeName}}</text>
        </view>
      </view>

      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <view class="worker-stats">
        <view class="stat-item">
          <text class="stat-number">{{item.completedCount || 0}}</text>
          <text class="stat-label">å·²å®Œæˆ</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{item.processingCount || 0}}</text>
          <text class="stat-label">å¤„ç†ä¸­</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{item.averageRating || '-'}}</text>
          <text class="stat-label">å¹³å‡è¯„åˆ†</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{item.registerDays || 0}}</text>
          <text class="stat-label">æ³¨å†Œå¤©æ•°</text>
        </view>
      </view>

      <!-- æ³¨å†Œæ—¶é—´ -->
      <view class="worker-footer">
        <text class="register-time">æ³¨å†Œæ—¶é—´ï¼š{{item.registerTimeText}}</text>
        <text class="view-detail-arrow">æŸ¥çœ‹è¯¦æƒ… â†’</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{workers.length === 0 && !loading}}">
      <text class="empty-icon">ğŸ‘·</text>
      <text class="empty-text">æš‚æ— ç»´ä¿®å·¥</text>
      <text class="empty-tip">{{emptyTip}}</text>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <text class="loading-icon">â³</text>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore && !loading && workers.length > 0}}">
      <button class="btn-load-more" bindtap="onLoadMore">åŠ è½½æ›´å¤š</button>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more" wx:if="{{!hasMore && workers.length > 0}}">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
  </view>

  <!-- åœ°åŒºé€‰æ‹©å¼¹çª— -->
  <view class="region-modal" wx:if="{{showRegionModal}}" catchtap="hideRegionModal">
    <view class="region-modal-content" catchtap="stopPropagation">
      <!-- æœç´¢æ¡† -->
      <view class="region-search-box">
        <input 
          class="region-search-input"
          placeholder="æœç´¢çœä»½æˆ–åŸå¸‚"
          value="{{regionSearchKeyword}}"
          bindinput="onRegionSearchInput"
        />
        <text class="region-search-icon">ğŸ”</text>
      </view>

      <!-- åœ°åŒºåˆ—è¡¨ -->
      <scroll-view class="region-list" scroll-y>
        <view 
          class="region-item {{selectedRegion === '' ? 'active' : ''}}"
          bindtap="selectRegion"
          data-region=""
        >
          å…¨å›½
        </view>
        <view 
          class="region-item {{selectedRegion === item ? 'active' : ''}}"
          wx:for="{{filteredWorkerRegions}}"
          wx:key="*this"
          bindtap="selectRegion"
          data-region="{{item}}"
        >
          {{item}}
        </view>
      </scroll-view>

      <!-- åº•éƒ¨æŒ‰é’® -->
      <view class="region-modal-footer">
        <button class="region-btn cancel" bindtap="hideRegionModal">å–æ¶ˆ</button>
        <button class="region-btn confirm" bindtap="confirmRegion">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view>
